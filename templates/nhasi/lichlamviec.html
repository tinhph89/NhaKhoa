{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>dental clinic</title>
        <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
        <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %} " rel="stylesheet" type="text/css">
        <link href="{% static 'css/jquery-ui.css' %} " rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
        <link href="{% static 'css/all.min.css' %}" rel="stylesheet">
        <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">
        <link href="{% static 'css/dataTables.bootstrap4.min.css' %}" rel="stylesheet">
        <link href="{% static 'css/evo-calendar.css' %}" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
        <style>
            .modal-dialog {
                max-width: 90%;
            }
            .scrollbox {
                height: 200px;
                overflow-y: scroll;
            }
            .wrapper {
               
                max-width: 1100px;
            }
            
            .container-calendar {
                background: #ffffff;
                padding: 20px;
                max-width: 100%;
                margin: 0 auto;
                overflow: auto;
            }
            
            .button-container-calendar button {
                cursor: pointer;
                display: inline-block;
                zoom: 1;
                background: #00a2b7;
                color: #fff;
                border: 1px solid #0aa2b5;
                border-radius: 5px;
                padding: 10px 15px;
            }
            
            .table-calendar {
                border-collapse: collapse;
                width: 100%;
            }
            
            .table-calendar td, .table-calendar th {
                padding: 8px;
                border: 1px solid #e2e2e2;
                text-align: center;
                vertical-align: top;
            }
            
            .date-picker.selected {
                font-weight: bold;
                outline: 1px dashed #00BCD4;
            }
            
            .date-picker.selected span {
                border-bottom: 2px solid currentColor;
            }
            
            /* sunday */
            .date-picker:nth-child(1) {
              color: red;
            }
            
            /* friday */
            .date-picker:nth-child(6) {
              color: green;
            }
            
            #monthAndYear {
                text-align: center;
                margin-top: 0;
            }
            
            .button-container-calendar {
                position: relative;
                margin-bottom: 1em;
                overflow: hidden;
                clear: both;
            }
            
            #previous {
                float: left;
            }
            
            #next {
                float: right;
            }
            
            .footer-container-calendar {
                margin-top: 1em;
                border-top: 1px solid #dadada;
                padding: 10px 0;
            }
            
            .footer-container-calendar select {
                cursor: pointer;
                display: inline-block;
                zoom: 1;
                background: #ffffff;
                color: #585858;
                border: 1px solid #bfc5c5;
                border-radius: 3px;
                padding: 5px 1em;
            }
            span:hover {
                cursor: pointer;
            }
        </style>
    </head>

    <body id="page-top">
        <!-- Page Wrapper -->
        <div id="wrapper">
            <!-- Sidebar -->
            <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion toggled" id="accordionSidebar">
                <!-- Sidebar - Brand -->
                <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                    <div class="sidebar-brand-text mx-3">Dental Clinic <sup>v.1.0</sup></div>
                </a>
                <!-- Divider -->
                <hr class="sidebar-divider my-0">
                <!-- Divider -->
                <hr class="sidebar-divider">
                <!-- Heading -->
                <div class="sidebar-heading">
                    Chức năng
                </div>
                <!-- Nav Item - Tables -->
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'nhasi' %}">
                        <i class="fas fa-fw fa-table"></i>
                        <span>Đăng ký khám</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'danhSach' %}">
                        <i class="fas fa-fw fa-table"></i>
                        <span>Danh sách đăng ký</span>
                    </a>
                </li>
                <!-- Nav Item - Tables -->
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'lichLamViec' %}">
                        <i class="fas fa-fw fa-chart-area"></i>
                        <span>Lịch làm việc</span>
                    </a>
                </li>

                <!-- Divider -->
                <hr class="sidebar-divider d-none d-md-block">

                <!-- Sidebar Toggler (Sidebar) -->
                <div class="text-center d-none d-md-inline">
                    <button class="rounded-circle border-0" id="sidebarToggle"></button>
                </div>
            </ul>
            <div id="content-wrapper" class="d-flex flex-column">
                <!-- Main Content -->
                <div id="content">
                    <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                        <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                            <i class="fa fa-bars"></i>
                        </button>
                        <!-- Topbar Navbar -->
                        <ul class="navbar-nav ml-auto">
                            <!-- Nav Item - User Information -->
                            <li class="nav-item dropdown no-arrow">
                                <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="mr-2 d-none d-lg-inline text-gray-600 small">
                                        <div style=" font-size: 15px;">Xin chào <b>{{user.username }}</b> </div>
                                    </span>
                                </a>
                                <!-- Dropdown - User Information -->
                                <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                    aria-labelledby="userDropdown">
                                  
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                        <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Thoát khỏi hệ thống
                                    </a>
                                </div>
                            </li>
                        </ul>

                    </nav>
                    <!-- Begin Page Content ------------------------------------------------------->
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xl-12 col-md-12 mb-12">
                                <div class="card border-left-primary shadow h-100 py-2">
                                    <div class="card-body">
                                        <div class="form-row align-items-center">
                                            <div class="form-group col-md-3">
                                            </div>
                                            <div class="form-group col-md-4">
                                                <div class='input-group has-validation'>
                                                    <input type='text' class="form-control" name="tenBacSi" id="tenBacSi" value="" placeholder="Tên bác sĩ" >
                                                    <input type='hidden' class="form-control" name="ma_so_bac_si" id="ma_so_bac_si" value="" >
                                                    
                                                    <a href="#" data-toggle="modal" data-target="#timBacSy">
                                                        <button type="button" style="height: 100%;"><i class="fa fa-search"></i></button>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="form-group col-md-4">
                                               
                                                <a href="#" data-toggle="modal" data-target="#timBenhNhan">
                                                    <button type="button" id="thietLapLich" name="thietLapLich"  class="btn btn-primary btn-md">Thiết lập lịch</button>
                                                </a>
                                            </div>   
                                        </div>
                                        <div class="form-row align-items-center">
                                            <div class="form-group col-md-3">
                                            </div>
                                            <div class="form-group col-md-6">

                                                    <div id = "show_hoten"></div>
                                            </div>
                                        </div>
                                        <div class="form-row align-items-center">
                                            <div class="form-group col-md-12">
                                                <div class="wrapper">

                                                    <div class="container-calendar">
                                                        
                                                        <div class="button-container-calendar">
                                                            <button id="previous" onclick="previous()">&#8249;</button>
                                                            <button id="next" onclick="next()">&#8250;</button>
                                                        </div>
                                                        
                                                        <table class="table-calendar" id="calendar" data-lang="en">
                                                            <thead id="thead-month"></thead>
                                                            <tbody id="calendar-body"></tbody>
                                                        </table>
                                                        <h3 id="monthAndYear" style="color: white;"></h3>
                                                        <div class="footer-container-calendar" style="
                                                        text-align: center;
                                                    ">
                                                          
                                                            <select id="month" onchange="jump()">
                                                                <option value=0>Tháng 1</option>
                                                                <option value=1>Tháng 2</option>
                                                                <option value=2>Tháng 3</option>
                                                                <option value=3>Tháng 4</option>
                                                                <option value=4>Tháng 5</option>
                                                                <option value=5>Tháng 6</option>
                                                                <option value=6>Tháng 7</option>
                                                                <option value=7>Tháng 8</option>
                                                                <option value=8>Tháng 9</option>
                                                                <option value=9>Tháng 10</option>
                                                                <option value=10>Tháng 11</option>
                                                                <option value=11>Tháng 12</option>
                                                            </select>
                                                            <select id="year" onchange="jump()"></select>       
                                                       </div>
                                                    </div>
                                                    
                                                </div>  
                                            </div>
                                                   
                                        </div>
                                    </div>

                                   
                                </div>
                            </div>
                            
                        </div>

                    </div>
                </div>
                <!-- Inquiry Modal -->
                <div class="modal fade" id="timBenhNhan" role="dialog">
                    <div class="modal-dialog" style="width: 50%;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 style="color: #446ad8;" class="modal-title" id="inquiryModalLabel">Thiết lập lịch</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-2">
                                        Tên bác sĩ
                                    </div>
                                    <div class="form-group col-md-8">
                                        <div class='input-group has-validation'>
                                            <input type='text' readonly class="form-control" name="ho_ten_nha_si" id="ho_ten_nha_si" value="" >
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-2">
                                        Ngày nghỉ
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="1" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 2
                                            </label>
                                           
                                          </div>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="2">
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 3
                                            </label>
                                           
                                          </div>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="3" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 4
                                            </label>
                                           
                                          </div>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="4" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 5
                                            </label>
                                           
                                          </div>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="5" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 6
                                            </label>
                                           
                                          </div>
                                    </div>
                                
                                </div>

                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-2">
                                       
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="6" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Thứ 7
                                            </label>
                                           
                                          </div>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="0" >
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Chủ nhật
                                            </label>
                                           
                                          </div>
                                    </div>
                                
                                </div>

                                <div class="form-row align-items-center">
                                    <div class="form-group col-md-2">
                                       
                                    </div>
                                    <div class="form-group col-md-8" style=" text-align: center;">
                                        <button type="button" id="luuNgayNghi" name="luuNgayNghi" class="btn btn-primary btn-md" >Lưu thông tin</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer -->
                <footer class="sticky-footer bg-white">
                    <div class="container my-auto">
                        <div class="copyright text-center my-auto">
                            <!-- <span>Copyright &copy; Nha</span><br> -->
                        </div>
                    </div>
                </footer>
            </div>
            <!-- Scroll to Top Button-->
            <a class="scroll-to-top rounded" href="#page-top">
                <i class="fas fa-angle-up"></i>
            </a>
            <!-- Logout Modal-->
            <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document" style="width: 50%;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Thoát khỏi hệ thống</h5>
                            <button class="close" type="button" data-dismiss="modal" aria-label="Đóng">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div class="modal-body">Hãy kiểm tra lại thông tin trước khi thoát hệ thống
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" type="button" data-dismiss="modal">Ở lại</button>
                            <a class="btn btn-primary"
                                href="javascript:{document.getElementById('logout').submit()}">Thoát</a>
                            <form action="{% url 'logout' %}" method="POST" id="logout">
                                {% csrf_token %}
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="timBacSy" role="dialog">
                <div class="modal-dialog" style="width: 50%;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 style="color: #446ad8;" class="modal-title" id="inquiryModalLabel">Tìm kiếm bác sĩ</h5>
                            <input type="hidden" value="" id="hiden_id_bs" name=="hiden_id_bs">
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            {% if nha_si %}
                            <table id="table_bacSi" class="display" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th width="20%" style="text-align: center;">Mã số</th>
                                        <th width="70%" style="text-align: center;">Bác sĩ</th>
                                        <th width="10%">&nbsp;</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for datans in nha_si %}
                                    <tr>
                                        <td width="20%" style="text-align: center;">{{datans.ma_so_nha_si}}</td>
                                        <td width="70%" style="text-align: left;">{{datans.ho_ten}}</td>
                                        <td width="10%" style="text-align: center;"><a href="#">Chọn </a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <p style="text-align: center;">Chưa có dữ liệu </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="{% static 'js/jquery-1.10.2.js' %}"></script>
        <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'js/jquery-ui.js' %}"></script>
        <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
        <script src="{% static 'js/sb-admin-2.min.js' %}"></script>
        <script src="{% static 'js/evo-calendar.js' %}"></script>
    </body>

    <script>
        var  ngay_nghi = []
        $(document).ready(function () {
            show_lich( ngay_nghi )
            $('#table_bacSi tbody').on('click', 'button', function () {
                var data = tableBs.row($(this).parents('tr')).data();
                $("#tenBacSi").val(data[1])
                $("#ho_ten_nha_si").val(data[1])
                $("#ma_so_bac_si").val(data[0])
                $("#inquiryModalLabel").text("Thiết lập lịch")
                $('input:checkbox').removeAttr('checked')
                $('#timBacSy').modal('toggle');
                $('#show_hoten').empty()
                $.ajax({
                    type: "GET",
                    url: "ajax_lay_lichNghi",
                    data: {
                        'ho_ten_nha_si': $("#ho_ten_nha_si").val(),
                        'ma_so_bac_si': $("#ma_so_bac_si").val()
                    },
                    success: function (parsedData) {
                        var obj = JSON.parse(parsedData);
                        //console.log(obj)
                        thoi_gian = obj[0]["fields"]["thoi_gian_nghi"]
                        ngay_nghi = thoi_gian
                        show_lich( thoi_gian )
                    }
                });
                
            });

            var tableBs = $('#table_bacSi').DataTable({
                "language": {
                    "lengthMenu": "Hiển thị _MENU_ bác sĩ",
                    "zeroRecords": "Không có dữ liệu - Xin lỗi",
                    "info": "Trang _PAGE_ của _PAGES_ trang",
                    "infoEmpty": "Không có dữ liệu",
                    "infoFiltered": "(Lọc từ _MAX_ tổng số bản ghi)",
                    "search": "Tìm kiếm",
                    "paginate": {
                        "previous": "Trang trước",
                        "next": "Trang sau",
                    }
                },
                "firstDayOfWeek":1,
                "columnDefs": [{
                    "targets": -1,
                    "data": null,
                    "defaultContent": "<button>Chọn</button>"
                }]
            });
        });

        $("#luuNgayNghi").click(function () {

            ht = $("#ho_ten_nha_si").val()
            if(ht == ""){
                alert("Chưa chọn bác sĩ để thiết lập lịch")
            }else{
                var sList = "";
                $('input[type=checkbox]').each(function () {
                    if (this.checked)
                        sList += $(this).val() + ", "
                });
                
                lich_nghi = sList.substring(0, sList.length - 2)
                lst_lich_nghi = "["+ lich_nghi+"]"
                $.ajax({
                    type: "GET",
                    url: "ajax_lichNghi",
                    data: {
                        'lich_nghi': lst_lich_nghi  ,
                        'ho_ten_nha_si': $("#ho_ten_nha_si").val(),
                        'ma_so_bac_si': $("#ma_so_bac_si").val()
                    },
                    success: function (parsedData) {
                    if(parsedData["id_alert"] == 0){
                        $("#inquiryModalLabel").text("Thiết lập lịch - Đã cập nhật thông tin")
                    }else if(parsedData["id_alert"] > 0){
                        $("#inquiryModalLabel").text("Thiết lập lịch - Đã thêm thông tin")
                    }else{
                        
                        $("#inquiryModalLabel").text("Thiết lập lịch")
                    }
                    }
                });
                show_lich(lich_nghi)
            }
            
        });
    
       
    function show_lich( ngay_nghi ){
        function generate_year_range(start, end) {
            var years = "";
            for (var year = start; year <= end; year++) {
                years += "<option value='" + year + "'>" + year + "</option>";
            }
            return years;
        }
        
        today = new Date();
        currentMonth = today.getMonth();
        currentYear = today.getFullYear();
        selectYear = document.getElementById("year");
        selectMonth = document.getElementById("month");
        
        
        createYear = generate_year_range(2020, 2030);
        /** or
         * createYear = generate_year_range( 1970, currentYear );
         */
        
        document.getElementById("year").innerHTML = createYear;
        
        var calendar = document.getElementById("calendar");
        var lang = calendar.getAttribute('data-lang');
        
        var months = "";
        var days = "";
        
        var monthDefault = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
        var dayDefault = ["CN", "T2", "T3", "T4", "T5", "T6", "T7"];
        
        if (lang == "en") {
            months = monthDefault;
            days = dayDefault;
        } 
        
        var $dataHead = "<tr>";
        for (dhead in days) {
            $dataHead += "<th data-days='" + days[dhead] + "'>" + days[dhead] + "</th>";
        }
        $dataHead += "</tr>";
        //alert($dataHead);
        document.getElementById("thead-month").innerHTML = $dataHead;
        
        monthAndYear = document.getElementById("monthAndYear");
        showCalendar(currentMonth, currentYear, ngay_nghi);
        
        function next() {
            currentYear = (currentMonth === 11) ? currentYear + 1 : currentYear;
            currentMonth = (currentMonth + 1) % 12;
            showCalendar(currentMonth, currentYear, ngay_nghi);
        }
        
        function previous() {
            currentYear = (currentMonth === 0) ? currentYear - 1 : currentYear;
            currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
            showCalendar(currentMonth, currentYear, ngay_nghi);
        }
        
        function jump() {
            currentYear = parseInt(selectYear.value);
            currentMonth = parseInt(selectMonth.value);
            showCalendar(currentMonth, currentYear,ngay_nghi);
        }
        
        function showCalendar(month, year,ngay_nghi) {
        
            var firstDay = ( new Date( year, month ) ).getDay();
        
            tbl = document.getElementById("calendar-body");
            
            tbl.innerHTML = "";
            
            monthAndYear.innerHTML = months[month] + " " + year;
            selectYear.value = year;
            selectMonth.value = month;
        
            // creating all cells
            var date = 1;
            for ( var i = 0; i < 6; i++ ) {
                
                var row = document.createElement("tr");

                for ( var j = 0; j < 7; j++ ) {
                    if ( i === 0 && j < firstDay ) {
                        cell = document.createElement( "td" );
                        cellText = document.createTextNode("");
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    } else if (date > daysInMonth(month, year)) {
                        break;
                    } else {
                        
                        cell = document.createElement("td");
                        cell.setAttribute("data-date", date);
                        cell.setAttribute("data-month", month + 1);
                        cell.setAttribute("data-year", year);
                        cell.setAttribute("data-month_name", months[month]);
                        cell.className = "date-picker";
                        if (ngay_nghi.includes(j)){
                            cell.innerHTML = "<span id = 'cl2'>" + "" + "</span>";
                        }else{
                            var d = date
                            var m = month + 1
                            var y = year
                            
                            dmy = d + "_" + m + "_" + y
                            cell.innerHTML = "<span id = 'cl1' onclick='myFunction("+d+", "+m+", "+y+")'>" + date + "</span>";
                        }
                              
                        if ( date === today.getDate() && year === today.getFullYear() && month === today.getMonth() ) {
                            cell.className = "date-picker selected";
                        }
                        row.appendChild(cell);
                        date++;
                    }
                }
        
                tbl.appendChild(row);
            }
        
        }
        
        function daysInMonth(iMonth, iYear) {
            return 32 - new Date(iYear, iMonth, 32).getDate();
        }

      
    }

   
    function myFunction(d,m,y) {
        ma_so  = $("#ma_so_bac_si").val()
        $.ajax({
            type: "GET",
            url: "ajax_lichChiTiet",
            data: {
                'ma_so_bac_si': ma_so,
                'dmy': d + "/" + m +"/" + y 
            },
            success: function (parsedData) {
                var obj = JSON.parse(parsedData);
                console.log(obj)
                nd = ""
                if (obj.length != 0) {
                    $('#show_hoten').empty()
                    $('#show_hoten').append("<b>Lịch khám bệnh </b> <br>");
                    for (i = 0; i < obj.length; i++) {
                        ho = obj[i]["fields"]["ho_benh_nhan"]
                        chu_lot =  obj[i]["fields"]["chu_lot_benh_nhan"]
                        ten = obj[i]["fields"]["ten_bn"]
                        hoten = ho + " " + chu_lot + " " + ten
                        noidungkham = obj[i]["fields"]["trieu_chung"]
                        thoigian = obj[i]["fields"]["thoi_gian_kham"]
                        nd = " Bệnh nhân  "+(i + 1)+": " + hoten + "<br>" + "Nội dung khám: "  + noidungkham + "<br>" + "Thời gian: " + thoigian + "<br> <br>"
                        $('#show_hoten').append(nd);
                    }
                } else{
                    $('#show_hoten').empty()
                    $('#show_hoten').append("<b> Không có lịch khám bệnh")
                }
            }
        });
    }

    function generate_year_range(start, end) {
            var years = "";
            for (var year = start; year <= end; year++) {
                years += "<option value='" + year + "'>" + year + "</option>";
            }
            return years;
        }
        
        today = new Date();
        currentMonth = today.getMonth();
        currentYear = today.getFullYear();
        selectYear = document.getElementById("year");
        selectMonth = document.getElementById("month");
        
        
        createYear = generate_year_range(2020, 2030);
        /** or
         * createYear = generate_year_range( 1970, currentYear );
         */
        
        document.getElementById("year").innerHTML = createYear;
        
        var calendar = document.getElementById("calendar");
        var lang = calendar.getAttribute('data-lang');
        
        var months = "";
        var days = "";
        
        var monthDefault = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
        
        var dayDefault = ["CN", "T2", "T3", "T4", "T5", "T6", "T7"];
        
        if (lang == "en") {
            months = monthDefault;
            days = dayDefault;
        } 
        
        
        var $dataHead = "<tr>";
        for (dhead in days) {
            $dataHead += "<th data-days='" + days[dhead] + "'>" + days[dhead] + "</th>";
        }
        $dataHead += "</tr>";
        
        //alert($dataHead);
        document.getElementById("thead-month").innerHTML = $dataHead;
        
        
        monthAndYear = document.getElementById("monthAndYear");
        showCalendar(currentMonth, currentYear, ngay_nghi);
        
        
        
        function next() {
            currentYear = (currentMonth === 11) ? currentYear + 1 : currentYear;
            currentMonth = (currentMonth + 1) % 12;
            showCalendar(currentMonth, currentYear, ngay_nghi);
        }
        
        function previous() {
            currentYear = (currentMonth === 0) ? currentYear - 1 : currentYear;
            currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
            showCalendar(currentMonth, currentYear, ngay_nghi);
        }
        
        function jump() {
            currentYear = parseInt(selectYear.value);
            currentMonth = parseInt(selectMonth.value);
            showCalendar(currentMonth, currentYear,ngay_nghi);
        }
        
        function showCalendar(month, year,ngay_nghi) {
        
            var firstDay = ( new Date( year, month ) ).getDay();
        
            tbl = document.getElementById("calendar-body");
        
            
            tbl.innerHTML = "";
        
            
            monthAndYear.innerHTML = months[month] + " " + year;
            selectYear.value = year;
            selectMonth.value = month;
        
            // creating all cells
            var date = 1;
            for ( var i = 0; i < 6; i++ ) {
                
                var row = document.createElement("tr");
        
                
                for ( var j = 0; j < 7; j++ ) {
                    if ( i === 0 && j < firstDay ) {
                        cell = document.createElement( "td" );
                        cellText = document.createTextNode("");
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    } else if (date > daysInMonth(month, year)) {
                        break;
                    } else {
                        
                        cell = document.createElement("td");
                        cell.setAttribute("data-date", date);
                        cell.setAttribute("data-month", month + 1);
                        cell.setAttribute("data-year", year);
                        cell.setAttribute("data-month_name", months[month]);
                        cell.className = "date-picker";
                        
                        if (ngay_nghi.includes(j)){
                            cell.innerHTML = "<span>" + "" + "</span>";
                        }else{
                            var d = date
                            var m = month + 1
                            var y = year
                            cell.innerHTML = "<span onclick='myFunction("+d+", "+m+", "+y+")'>" + date + "</span>";
                        }
                        
                        if ( date === today.getDate() && year === today.getFullYear() && month === today.getMonth() ) {
                            cell.className = "date-picker selected";
                        }
                        row.appendChild(cell);
                        date++;
                    }
                }
        
                tbl.appendChild(row);
            }
        
        }
        
        function daysInMonth(iMonth, iYear) {
            return 32 - new Date(iYear, iMonth, 32).getDate();
        }
    
        
    </script>
</body>

</html>